<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulir Adopsi - StrayLink</title>
  <link rel="icon" href="logo.png" />
  <style>
    nav a {font-size: 16px;color: #333;text-decoration: none;padding: 8px 10px;border-radius: 8px;   }
    nav a:hover { background: #fff3e6; }
    body{margin:0;font-family:Arial, sans-serif;background:#4ad4cd}
    header{display:flex;justify-content:space-between;align-items:center;padding:15px 30px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .logo{font-weight:700;color:#007474}
    main{padding:20px;max-width:880px;margin:18px auto}
    .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 3px 12px rgba(0,0,0,.12)}
    .row{display:flex;gap:14px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    label{display:block;margin-top:10px;font-weight:600}
    input[type=text],input[type=email],textarea,input[type=tel]{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6;margin-top:6px}
    textarea{min-height:100px}
    .btn{display:inline-block;margin-top:14px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
    .btn-primary{background:#2ea8a8;color:#fff}
    .btn-muted{background:#f3f3f3}
    .pet-preview{display:flex;gap:12px;align-items:center}
    .pet-preview img{width:110px;height:90px;object-fit:cover;border-radius:8px}
    .small{font-size:13px;color:#666}
  </style>
</head>
<body>
<header>
        <div class="logo">StrayLink</div>
        <nav>
            <a href="index.html">Beranda</a>
            <a href="adopsi.html">Adopsi</a>
            <a href="donasi.html">Donasi</a>
            <a href="konsultasi.html">Konsultasi</a>
            <a href="profile.html">Profile</a>
            <a href="event.html">Event</a>
        </nav>
    </header>

  <main>
    <div class="card">
      <h2>Formulir Adopsi</h2>
      <p class="small">Lengkapi formulir berikut untuk mengajukan adopsi. Data akan disimpan di browser (localStorage) sebagai simulasi pengajuan.</p>

      <div id="pet" class="pet-preview" style="margin-bottom:10px"></div>

      <form id="adoptForm">
        <div class="row">
          <div class="col">
            <label for="nama">Nama Lengkap</label>
            <input id="nama" name="nama" type="text" required />

            <label for="email">Email</label>
            <input id="email" name="email" type="email" required />

            <label for="phone">Nomor Telepon</label>
            <input id="phone" name="phone" type="tel" placeholder="0812xxxx" />

            <label for="alamat">Alamat Lengkap</label>
            <input id="alamat" name="alamat" type="text" />
          </div>

          <div class="col">
            <label for="alasan">Alasan Mengadopsi / Keterangan (maks 500 karakter)</label>
            <textarea id="alasan" name="alasan" maxlength="500" required></textarea>

            <label for="pengalaman">Pengalaman Merawat Hewan</label>
            <select id="pengalaman" name="pengalaman">
              <option value="tidak">Tidak ada</option>
              <option value="sedikit">Pernah merawat sebelumnya</option>
              <option value="banyak">Sering merawat / punya hewan peliharaan</option>
            </select>

            <label for="referensi">Kontak Darurat / Referensi</label>
            <input id="referensi" name="referensi" type="text" placeholder="Nama - Nomor" />
          </div>
        </div>

        <div style="margin-top:12px">
          <label><input id="agree" type="checkbox" required /> Saya menyetujui bahwa informasi yang saya kirimkan jujur dan dapat dihubungi.</label>
        </div>

        <div style="margin-top:14px">
          <button type="submit" class="btn btn-primary">Kirim Permohonan</button>
          <button type="button" class="btn btn-muted" id="cancelBtn">Batal</button>
        </div>
      </form>

    </div>
  </main>

  <script>
    // Ambil param hewanId
    const params = new URLSearchParams(location.search);
    const hewanId = parseInt(params.get('hewanId')) || null;

    // Baca user login (sama dengan adopsi.html)
    const logged = JSON.parse(localStorage.getItem('loggedInUser') || 'null');

    // Baca data hewan dari localStorage (sama struktur di adopsi.html)
    function loadHewan(){
      const sample = [
        { id: 1, nama: 'Milo', jenis: 'kucing', ras: 'Domestic Short Hair', gender:'jantan', usia_bulan:18, foto:'cat1.png', deskripsi:'Ringan, manja, suka bermain.' , shelter_id: null, status:'tersedia'},
        { id: 2, nama: 'Luna', jenis: 'anjing', ras: 'Labrador mix', gender:'betina', usia_bulan:24, foto:'dog1.jpg', deskripsi:'Ramah, cocok keluarga.' , shelter_id: null, status:'tersedia'}
      ];
      let arr = JSON.parse(localStorage.getItem('hewan') || 'null');
      if(!arr || !arr.length){ arr = sample; localStorage.setItem('hewan', JSON.stringify(arr)); }
      return arr;
    }

    const hewan = hewanId ? loadHewan().find(h => h.id === hewanId) : null;

    const petEl = document.getElementById('pet');
    if(!hewan){
      petEl.innerHTML = '<div class="small">Hewan tidak ditemukan. Kembali ke <a href="adopsi.html">daftar adopsi</a>.</div>';
    } else {
      petEl.innerHTML = `
        <img src="${hewan.foto || 'https://via.placeholder.com/160x120?text=No+Image'}" alt="${hewan.nama}">
        <div>
          <strong>${hewan.nama}</strong>
          <div class="small">${hewan.jenis} • ${hewan.ras || '-'} • ${hewan.usia_bulan} bulan</div>
          <div style="margin-top:6px" class="small">${(hewan.deskripsi||'-')}</div>
        </div>
      `;
    }

    // Prefill form jika ada user login
    if(logged){
      document.getElementById('nama').value = logged.name || '';
      document.getElementById('email').value = logged.email || '';
    }

    // Jika tidak login, tetap izinkan pengisian (tapi berikan peringatan saat submit)
    document.getElementById('adoptForm').addEventListener('submit', function(e){
      e.preventDefault();
      if(!hewan){ alert('Tidak ada hewan yang dipilih.'); return; }

      if(!logged){
        const ok = confirm('Kamu belum login. Data akan tersimpan tanpa terikat akun. Lanjutkan?');
        if(!ok) return;
      }

      const adopsi = JSON.parse(localStorage.getItem('adopsi') || '[]');
      const form = e.target;

      const newA = {
        id: Date.now(),
        hewan_id: hewan.id,
        pengaju_email: (logged && logged.email) || form.email.value || null,
        pengaju_nama: form.nama.value,
        phone: form.phone.value || null,
        alamat: form.alamat.value || null,
        pengalaman: form.pengalaman.value,
        referensi: form.referensi.value || null,
        aplikasi_text: form.alasan.value,
        tanggal_diajukan: new Date().toISOString(),
        status: 'pending'
      };

      adopsi.push(newA);
      localStorage.setItem('adopsi', JSON.stringify(adopsi));

      alert('Permohonan adopsi terkirim! Shelter akan menghubungi Anda jika diterima.');
      // Redirect kembali ke daftar adopsi
      location.href = 'adopsi.html';
    });

    document.getElementById('cancelBtn').addEventListener('click', ()=>{
      location.href = 'adopsi.html';
    });
  </script>
</body>
</html>
