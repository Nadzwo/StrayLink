<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Konsultasi - StrayLink</title>
  <link rel="icon" href="logo.png" />
  <style>
    body{margin:0;font-family:Arial, sans-serif;background:#4ad4cd}
    header{display:flex;justify-content:space-between;align-items:center;padding:15px 30px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .logo{font-weight:700;color:#007474}
    nav a {font-size: 16px;color: #333;text-decoration: none;padding: 8px 10px;border-radius: 8px;   }
    nav a:hover { background: #fff3e6; }
    main{padding:24px;max-width:900px;margin:0 auto}
    .card{background:#fff;padding:14px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,.12);margin-bottom:14px}
    input, textarea{width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-top:10px}
    .btn{padding:10px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-primary{background:#2ea8a8;color:#fff}
    .small{font-size:13px;color:#666}
  </style>
</head>
<body>
<header>
        <div class="logo">StrayLink</div>
        <nav>
            <a href="index.html">Beranda</a>
            <a href="adopsi.html">Adopsi</a>
            <a href="donasi.html">Donasi</a>
            <a href="konsultasi.html">Konsultasi</a>
            <a href="profile.html">Profile</a>
            <a href="event.html">Event</a>
        </nav>
    </header>

  <main>
    <h2>Konsultasi Ringan</h2>
    <p class="small">Tanyakan masalah kesehatan atau perilaku hewan. Tim akan membalas melalui email.</p>

    <div class="card">
      <h3>Ajukan Konsultasi</h3>
      <div>
        <input id="k-subject" placeholder="Judul / singkat masalah (mis. 'Kucing muntah')">
        <textarea id="k-desc" rows="5" placeholder="Jelaskan kondisi hewan, usia, gejala, dan foto (opsional)."></textarea>
        <button class="btn btn-primary" onclick="submitKonsul()">Kirim Permintaan</button>
      </div>
    </div>

    <div class="card">
      <h3>Riwayat Permintaan Saya</h3>
      <div id="riwayat"></div>
    </div>
  </main>

  <script>
    const user = JSON.parse(localStorage.getItem('loggedInUser') || 'null');

    function loadData(){ return JSON.parse(localStorage.getItem('konsultasi') || '[]'); }

    function renderRiwayat(){
      const list = loadData();
      const my = user ? list.filter(x => x.user_email === user.email) : [];
      const dst = document.getElementById('riwayat');
      if(!user){ dst.innerHTML = '<p>Silakan <a href="login.html">login</a> untuk melihat riwayat konsultasi.</p>'; return; }
      if(my.length === 0) { dst.innerHTML = '<p>Belum ada permintaan konsultasi.</p>'; return; }
      dst.innerHTML = my.map(x => `
        <div style="border-bottom:1px solid #eee;padding:8px 0">
          <strong>${x.subject}</strong>
          <div class="small">Dikirim: ${new Date(x.tanggal).toLocaleString()}</div>
          <div style="margin-top:6px">${(x.desc||'').replace(/\n/g,'<br>')}</div>
          <div class="small" style="margin-top:6px">Status: <strong>${x.status}</strong></div>
        </div>
      `).join('');
    }

    function submitKonsul(){
      if(!user){ alert('Silakan login terlebih dahulu.'); window.location='login.html'; return; }
      const subj = document.getElementById('k-subject').value.trim();
      const desc = document.getElementById('k-desc').value.trim();
      if(!subj || !desc){ alert('Judul dan deskripsi wajib diisi.'); return; }
      const arr = loadData();
      const payload = {
        id: Date.now(),
        user_email: user.email,
        user_name: user.name,
        subject: subj,
        desc: desc,
        tanggal: new Date().toISOString(),
        status: 'menunggu' // bisa diupdate oleh admin nanti
      };
      arr.push(payload);
      localStorage.setItem('konsultasi', JSON.stringify(arr));
      alert('Permintaan konsultasi terkirim. Cek riwayat untuk statusnya.');
      document.getElementById('k-subject').value = '';
      document.getElementById('k-desc').value = '';
      renderRiwayat();
    }

    renderRiwayat();
  </script>
</body>
</html>
